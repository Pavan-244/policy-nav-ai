{% extends 'base.html' %}
{% block content %}
<h2 class="section-title mb-3">Education Policy Search</h2>
<div class="card">
  <div class="card-body">
    <form id="edu-form" class="row g-3">
      <div class="col-lg-6">
        <label class="form-label" for="edu-q">Query</label>
        <input id="edu-q" class="form-control" placeholder="e.g., teacher training funding" required />
      </div>
      <div class="col-6 col-lg-2">
        <label class="form-label" for="edu-k">Top K</label>
        <input id="edu-k" type="number" class="form-control" min="1" max="20" value="3" />
      </div>
      <div class="col-md-3 col-lg-2">
        <label class="form-label" for="edu-sector">Sector</label>
        <input id="edu-sector" class="form-control" placeholder="e.g., Higher Ed" />
      </div>
      <div class="col-md-3 col-lg-2">
        <label class="form-label" for="edu-region">Region</label>
        <input id="edu-region" class="form-control" placeholder="e.g., Europe" />
      </div>
      <div class="col-md-3 col-lg-2">
        <label class="form-label" for="edu-status">Status</label>
        <input id="edu-status" class="form-control" placeholder="e.g., Active" />
      </div>
      <div class="col-md-3 col-lg-2">
        <label class="form-label" for="edu-year">Year</label>
        <input id="edu-year" class="form-control" placeholder="e.g., 2022" />
      </div>
      <div class="col-12">
        <button class="btn btn-brand" type="submit">Search</button>
        <a class="btn btn-outline-light ms-2" href="/education/visualizations">View Visualizations</a>
        <a class="btn btn-outline-light ms-2" href="/education/quantum">Quantum Search</a>
      </div>
    </form>
  <div id="edu-results" class="mt-3" aria-live="polite"></div>
  </div>
</div>

<script>
const eduForm = document.getElementById('edu-form');
const eduResults = document.getElementById('edu-results');

eduForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  eduResults.innerHTML = '<div class="text-muted">Searching…</div>';
  const q = document.getElementById('edu-q').value.trim();
  const k = document.getElementById('edu-k').value || 3;
  const sector = document.getElementById('edu-sector').value.trim();
  const region = document.getElementById('edu-region').value.trim();
  const status = document.getElementById('edu-status').value.trim();
  const year = document.getElementById('edu-year').value.trim();
  const params = new URLSearchParams({ query: q, top_k: k });
  if (sector) params.append('sector', sector);
  if (region) params.append('region', region);
  if (status) params.append('status', status);
  if (year) params.append('year', year);
  try {
    const res = await fetch(`/education/search?${params.toString()}`);
    const data = await res.json();
    const out = (data.results || []).map(r => `
      <div class="border-top pt-2 mt-2">
        <div class="d-flex justify-content-between">
          <div><strong>${r['Title'] || ''}</strong></div>
          <div><span class="badge badge-soft ms-2">${(r['Similarity']||0).toFixed(3)}</span></div>
        </div>
        <div class="text-muted-2">${r['Sector'] || ''} • ${r['Region'] || ''} • ${r['Year'] || ''} • ${r['Status'] || ''}</div>
        <div class="small text-muted-2">Funding: ${r['Funding (USD M)'] || '—'} • Impact: ${r['Impact Score'] || '—'}</div>
        <div class="small">${r['Summary'] || ''}</div>
      </div>`).join('');
    eduResults.innerHTML = out || '<div class="text-muted">No results</div>';
  } catch (e) {
    eduResults.innerHTML = '<div class="text-danger">Failed to search.</div>';
  }
});
</script>
{% endblock %}
