<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Education Policy Search - PolicyNav</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div style="background: linear-gradient(135deg, #4CAF50 0%, #81C784 100%); color: white; padding: 1.5em; border-radius: 8px; margin-bottom: 2em;">
        <h1 style="color: white; margin-bottom: 0.3em;">üéì Education Policy Navigator</h1>
        <p style="opacity: 0.9; margin: 0;">AI-Powered Education Records & Policy Search</p>
    </div>
    <nav>
        <a href="/">üè† Home</a> | 
        <a href="/education">üîç Search</a> | 
        <a href="/education/visualizations">üìä Visualizations</a>
    </nav>

    <!-- Search Form Section -->
    <form id="eduSearchForm">
        <h2>Search Education Policies</h2>
        <div style="margin-bottom: 1em;">
            <label style="display: block;">
                <strong>Query:</strong>
                <input name="query" type="text" required placeholder="Enter search query (e.g., rural education, free materials)" style="width: 100%; max-width: 500px;">
            </label>
        </div>
        
        <div style="margin-bottom: 1em;">
            <label>
                <strong>Top Results:</strong>
                <input name="top_k" value="3" type="number" min="1" max="10" style="width: 80px;">
            </label>
        </div>

        <h3>Optional Filters</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1em; margin-bottom: 1em;">
            <label>
                <strong>Sector:</strong>
                <input name="sector" type="text" placeholder="e.g., primary, secondary">
            </label>
            <label>
                <strong>Region:</strong>
                <input name="region" type="text" placeholder="e.g., Uttar Pradesh">
            </label>
            <label>
                <strong>Status:</strong>
                <input name="status" type="text" placeholder="e.g., active, proposed">
            </label>
            <label>
                <strong>Year:</strong>
                <input name="year" type="text" placeholder="e.g., 2022">
            </label>
        </div>
        
        <button type="submit">üîé Search Records</button>
        <button type="button" onclick="clearEduForm()" style="background: #666;">Clear</button>
    </form>

    <hr>

    <!-- Loading Indicator -->
    <div id="eduLoading" style="display: none; text-align: center; padding: 2em;">
        <p>Searching education records...</p>
    </div>

    <!-- Results Section -->
    <div id="eduResults"></div>

    <script>
        function clearEduForm() {
            document.getElementById('eduSearchForm').reset();
            document.getElementById('eduResults').innerHTML = '';
        }

        document.getElementById('eduSearchForm').onsubmit = async function(e) {
            e.preventDefault();
            
            // Show loading indicator
            const loadingDiv = document.getElementById('eduLoading');
            const resultsDiv = document.getElementById('eduResults');
            loadingDiv.style.display = 'block';
            resultsDiv.innerHTML = '';
            
            try {
                let form = new FormData(this);
                let url = `/education/search?` + new URLSearchParams(form).toString();
                let res = await fetch(url);
                
                if (!res.ok) {
                    throw new Error('Search request failed');
                }
                
                let data = await res.json();
                
                // Hide loading indicator
                loadingDiv.style.display = 'none';
                
                if (!data.results || data.results.length === 0) {
                    resultsDiv.innerHTML = `
                        <div style="background: #fff3cd; padding: 1em; border-radius: 5px; border-left: 4px solid #ffc107;">
                            <strong>No Results Found</strong>
                            <p>No matching records found. Try adjusting your search terms or filters.</p>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = data.results.map((r, i) => {
                        const sim = r["Similarity"] !== undefined ? (r["Similarity"] * 100).toFixed(1) + '%' : 'N/A';
                        return `
                        <div class="result">
                            <h2>Result #${i + 1} <span style="color: #666; font-size: 0.8em;">(Similarity: ${sim})</span></h2>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5em;">
                                <div>
                                    <h3 style="color: #02577A; margin-top: 0;">Policy Overview</h3>
                                    <ul style="list-style: none; padding-left: 0;">
                                        <li><b>üÜî Policy ID:</b> ${r["Policy ID"] || 'N/A'}</li>
                                        <li><b>ÔøΩ Title:</b> ${r["Title"] || 'N/A'}</li>
                                        <li><b>üè∑Ô∏è Sector:</b> ${r["Sector"] || 'N/A'}</li>
                                        <li><b>ÔøΩÔ∏è Region:</b> ${r["Region"] || 'N/A'}</li>
                                        <li><b>üìÖ Year:</b> ${r["Year"] || 'N/A'}</li>
                                        <li><b>üìä Status:</b> ${r["Status"] || 'N/A'}</li>
                                        <li><b>üë• Target Group:</b> ${r["Target Group"] || 'N/A'}</li>
                                    </ul>
                                </div>
                                <div>
                                    <h3 style="color: #02577A; margin-top: 0;">Details</h3>
                                    <ul style="list-style: none; padding-left: 0;">
                                        <li><b>üíµ Funding (USD M):</b> ${r["Funding (USD M)"] || 'N/A'}</li>
                                        <li><b>‚≠ê Impact Score:</b> ${r["Impact Score"] || 'N/A'}</li>
                                        <li><b>ü§ù Stakeholders:</b> ${r["Stakeholders"] || 'N/A'}</li>
                                        <li><b>üß≠ Goals:</b> ${r["Goals"] || 'N/A'}</li>
                                    </ul>
                                </div>
                            </div>
                            ${r["Summary"] ? `<div style="margin-top: 0.5em;"><b>üìù Summary:</b> ${r["Summary"]}</div>` : ''}
                        </div>`;
                    }).join('');
                }
            } catch (error) {
                // Hide loading indicator
                loadingDiv.style.display = 'none';
                
                resultsDiv.innerHTML = `
                    <div style="background: #f8d7da; padding: 1em; border-radius: 5px; border-left: 4px solid #dc3545;">
                        <strong>Error</strong>
                        <p>An error occurred while searching. Please try again.</p>
                        <p style="color: #666; font-size: 0.9em;">${error.message}</p>
                    </div>
                `;
            }
        };
    </script>
</body>
</html>
